head     1.2;
access   ;
symbols  ;
locks    mtakiuch:1.2; strict;
comment  @@;


1.2
date     2011.01.06.18.02.55;  author mtakiuch;  state Exp;
branches ;
next     1.1;

1.1
date     2010.12.13.10.47.54;  author mtakiuch;  state Exp;
branches ;
next     ;


desc
@@


1.2
log
@*** empty log message ***
@
text
@REM
REM =head1 NAME 
REM
REM cr_ts_heya_need_sum.sql
REM
REM =head1 DESCRIPTION
REM 
REM 設備情報を直近の供給データから算出する
REM 算出したデータをTS_SETUBI_NEEDS_SUMテーブルに保存。（都度作成するので事前にＤＲＯＰ）
REM
REM =head1 HISTORY
REM
REM =over 4
REM
REM =item 2010/10/25 M.TAKIUCHI CREATED
REM
REM =item 2010/10/25 M.TAKIUCHI COMMENT ADD FOR POD
REM
REM =back
REM
REM =head1 Trouble Shooting
REM
REM テーブルをドロップして何度も再実行可能
REM
REM =head1 AUTHOR
REM 
REM システム部　@瀧内誠(mtakiuc@@kantei.co.jp)
REM
REM =cut
REM
CREATE TABLE TS_SETUBI_NEEDS_SUM
AS
select
			TS_TATEMONO.JUSHOCD1,
			TS_TATEMONO.JUSHOCD2,
			TS_TATEMONO.TATEMONO_SYUBETU,
			TS_HEYA.MADORI,
			SUM(TS_HEYA_SETUBI.SETUBI026) AIR_CON,
			SUM(TS_HEYA_SETUBI.SETUBI018) SEP_BATH,
			SUM(TS_HEYA_SETUBI.SETUBI005) GAS_STOVE,
			SUM(TS_HEYA_SETUBI.SETUBI037) CLOSET,
			SUM(TS_HEYA_SETUBI.SETUBI017) IND_SINK,
			SUM(TS_HEYA_SETUBI.SETUBI049) AUTO_LOCK,
			SUM(TS_HEYA_SETUBI.SETUBI022) TV_INTER_PHONE,
			SUM(TS_HEYA_SETUBI.SETUBI020) WASHING_TOILET,
			SUM(TS_HEYA_SETUBI.SETUBI012) BATH_DRYER,
			SUM(TS_HEYA_SETUBI.SETUBI016) WASHING_MACHINE_BATH,
			SUM(TS_HEYA_SETUBI.SETUBI059) BALCONY,
			SUM(TS_HEYA_SETUBI.SETUBI043) EV,
			SUM(TS_HEYA_SETUBI.SETUBI024) DELIVERY_BOX,
			SUM(TS_HEYA_SETUBI.SETUBI038) UNDER_FLOOR,
			SUM(TS_HEYA_SETUBI.SETUBI047) DUST_COL,
			SUM(TS_HEYA_SETUBI.SETUBI045) BICYCLE_PARKING,
			SUM(TS_HEYA_SETUBI.SETUBI066) OPTICAL_FIBER,
			SUM(TS_HEYA_SETUBI.SETUBI011) REHEAT,
			SUM(TS_HEYA_SETUBI.SETUBI015) SHAMPOO_DRESSER,
			SUM(TS_HEYA_SETUBI.SETUBI033) FLOORING,
			SUM(TS_HEYA_SETUBI.SETUBI036) WALK_IN_CLOSET,
			SUM(TS_HEYA_SETUBI.SETUBI029) FLOOR_HEAT,
			SUM(TS_HEYA_SETUBI.SETUBI003) IH_COOKINGHEATER,
			SUM(TS_HEYA_SETUBI.SETUBI041) ALL_ELECTRIC,
			SUM(TS_HEYA_SETUBI.SETUBI060) VERANDA,
			SUM(TS_HEYA_SETUBI.SETUBI001) SYSTEM_KITCHEN,
			SUM(TS_HEYA_SETUBI.SETUBI064) CATV,
			SUM(TS_HEYA_SETUBI.SETUBI057) LOFT,
			COUNT(*) CNT
			FROM TS_HEYA_SETUBI,TS_TATEMONO,TS_HEYA
			where
			TS_HEYA_SETUBI.TATEMONO_CD = TS_TATEMONO.TATEMONO_CD
			AND TS_HEYA.TATEMONO_CD = TS_TATEMONO.TATEMONO_CD
			AND TS_HEYA_SETUBI.TOIAWASE_NO = TS_TATEMONO.TOIAWASE_NO
			AND TS_HEYA.TOIAWASE_NO = TS_TATEMONO.TOIAWASE_NO
			AND TS_HEYA.ROOMNO = TS_HEYA_SETUBI.ROOMNO
			AND TS_HEYA.PRIORITY=1
			AND
			months_between(sysdate,TS_TATEMONO.kansei_ymd) >= 36
			AND
			(TS_HEYA_SETUBI.tatemono_cd,TS_HEYA_SETUBI.toiawase_no,TS_HEYA_SETUBI.roomno) 
			in 
			(
				select
						tatemono_cd,
						toiawase_no,
						roomno
				from ts_heya_tinryo_his
				where start_flg != '1'
						and start_flg != '1'
						and tinryo_his_ymd = to_date('&&THIS_KYOKYU_YMD', 'yyyymmdd')
			)
				group by
					TS_TATEMONO.JUSHOCD1,
					TS_TATEMONO.JUSHOCD2,
					TS_TATEMONO.TATEMONO_SYUBETU,
					TS_HEYA.MADORI
/
@


1.1
log
@Initial revision
@
text
@d1 30
d38 29
a66 28
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI026)/COUNT(*)*100) AIR_CON,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI018)/COUNT(*)*100) SEP_BATH,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI006)/COUNT(*)*100) GAS_STOVE,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI037)/COUNT(*)*100) CLOSET,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI017)/COUNT(*)*100) IND_SINK,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI049)/COUNT(*)*100) AUTO_LOCK,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI022)/COUNT(*)*100) TV_INTER_PHONE,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI020)/COUNT(*)*100) WASHING_TOILET,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI012)/COUNT(*)*100) BATH_DRYER,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI016)/COUNT(*)*100) WASHING_MACHINE_BATH,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI059)/COUNT(*)*100) BALCONY,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI043)/COUNT(*)*100) EV,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI024)/COUNT(*)*100) DELIVERY_BOX,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI038)/COUNT(*)*100) UNDER_FLOOR,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI047)/COUNT(*)*100) DUST_COL,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI046)/COUNT(*)*100) BICYCLE_PARKING,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI066)/COUNT(*)*100) OPTICAL_FIBER,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI011)/COUNT(*)*100) REHEAT,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI015)/COUNT(*)*100) SHAMPOO_DRESSER,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI033)/COUNT(*)*100) FLOORING,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI036)/COUNT(*)*100) WALK_IN_CLOSET,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI029)/COUNT(*)*100) FLOOR_HEAT,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI003)/COUNT(*)*100) IH_COOKINGHEATER,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI041)/COUNT(*)*100) ALL_ELECTRIC,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI060)/COUNT(*)*100) VERANDA,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI001)/COUNT(*)*100) SYSTEM_KITCHEN,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI064)/COUNT(*)*100) CATV,
			ROUND(SUM(TS_HEYA_SETUBI.SETUBI057)/COUNT(*)*100) LOFT
d74 1
a74 1
			AND TS_TATEMONO.PRIORITY=1
a95 3
REM CREATE INDEX TS_NEED_SUM_JUSHOCD ON TS_SETUBI_NEEDS_SUM(JUSHOCD1,JUSHOCD2);
REM CREATE INDEX TS_NEED_SUM_TSYUBETU ON TS_SETUBI_NEEDS_SUM(TATEMONO_SYUBETU);
REM CREATE INDEX TS_NEED_SUM_MADORI ON TS_SETUBI_NEEDS_SUM(MADORI);
@
